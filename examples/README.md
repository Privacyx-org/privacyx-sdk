# Privacyx SDK — Examples

This folder contains small, self-contained examples showing how to use the
Privacyx SDK with the different PXP standards.

All examples are written as ESM modules (`.mjs`) and are meant to be run with Node.js 18+.

---

## 1) PXP-101 — Balance Pass (read-only example)

**File:** `node-read-root.mjs`

This script shows how to:

- Instantiate the PrivacyX SDK with a BalancePass contract
- Read the current Merkle root on-chain

### Run

```bash
node examples/node-read-root.mjs
You may want to edit the file to:

point to your own RPC URL,

change the balancePassAddress,

or switch chainId.

---

## 2) PXP-102 — Identity Pass (IO / API reference example)
Files:

identity-pass-node.example.mjs

identity_proof.example.json

identity_public.example.json

This example demonstrates how a backend or dApp will:

Instantiate the PXP-102 IdentityPass module from privacyx-sdk

Load a Groth16 identity proof from JSON

Load public signals [root, issuerHash, nullifierHash] from JSON

Convert them to bigint[] and call submitProof(...)

⚠️ Important:
As of now, IdentityPass.submitProof() is still marked as WIP and will
throw a PrivacyXError("... not implemented yet (PXP-102 WIP)").

The goal of this example is to lock the IO & API shape:

JSON format of proofs and public signals

TypeScript / JS signatures for the SDK

High-level integration pattern for future implementations

Environment variables
The script expects:

RPC_URL — JSON-RPC endpoint (e.g. an Infura / Alchemy URL)

PRIVATE_KEY — private key used as the signer

IDENTITY_PASS_ADDRESS — (optional) IdentityPass contract address
Defaults to 0x0000000000000000000000000000000000000000 as a placeholder.

Run
bash
Copier le code
export RPC_URL="https://mainnet.infura.io/v3/YOUR_KEY"
export PRIVATE_KEY="0xYOUR_PRIVATE_KEY"
export IDENTITY_PASS_ADDRESS="0xIdentityPassContractAddress"  # optional for now

node examples/identity-pass-node.example.mjs
You should see:

The dummy proof object logged

The dummy public signals logged as bigint[]

An error explaining that IdentityPass.submitProof is not yet implemented

This confirms the wiring without requiring a real circuit or live contract.

Notes
For a full PXP-102 implementation, see:

privacyx-identity-pass repo (contracts + tests + ZK IO format)

zk/identity_proof.example.json and zk/identity_public.example.json there

For PXP-101 details, see:

PXP-101.md in the privacyx-balance-pass repo

---

## 3) ZK IO helpers — Parsing Groth16 proof & pubSignals

**File:** `identity-parse.example.mjs`

This script shows how to:

- Load a Groth16 proof JSON (snarkjs-style)
- Load public signals `[root, issuerHash, nullifierHash]` from JSON
- Parse them into `BigInt` arrays using the internal helpers:

  - `parseGroth16Proof(proofJson)`
  - `parsePubSignals(pubSignalsJson, expectedLength)`

### Run

```bash
node examples/identity-parse.example.mjs

You should see:

- Parsed Groth16 proof: { ... BigInt ... }
- Parsed public signals (bigint[]): [ ... ]

---

## 4) PXP-102 — Identity Pass (local Hardhat demo, Groth16 end-to-end)

**File:** `identity-pass-local-hardhat.example.mjs`

This script shows a full **PXP-102 Groth16 pipeline**:

- A real Groth16 circuit compiled with Circom (`identity_pass.circom`)
- A Groth16 verifier contract generated by snarkjs (`IdentityPassVerifier.sol`)
- The `IdentityPass` reference contract wired to this verifier
- A real Groth16 proof + public signals stored as JSON
- The `privacyx-sdk` `IdentityPass` module calling `submitProof(...)`
- On-chain nullifier flip `false → true`

### Prerequisites

In the `privacyx-identity-pass` repo:

1. Start a local Hardhat node:

cd ~/privacyx-identity-pass  
npx hardhat node

2. In another terminal, deploy IdentityPassVerifier + IdentityPass and initialize the issuer/root with values matching `zk/identity_public.example.json`:

cd ~/privacyx-identity-pass  
npx hardhat run scripts/deploy-local-with-verifier.js --network localhost

You will see logs similar to:

IdentityPassVerifier deployed at: 0x...  
IdentityPass deployed at: 0x...  
issuerField (decimal): 2  
root: 5  

Keep the IdentityPass address (e.g. `0xe7f1...`).

### Run the SDK demo

Back in the `privacyx-sdk` repo:

cd ~/privacyx-sdk  

export RPC_URL="http://127.0.0.1:8545"  
export PRIVATE_KEY="0xac0974be..."                       # one of the Hardhat accounts  
export IDENTITY_PASS_ADDRESS="0x<IdentityPass address>"  # from deploy-local-with-verifier.js logs  

node examples/identity-pass-local-hardhat.example.mjs

You should see:

- The parsed Groth16 proof and public signals  
- The current root on-chain for the issuer (`getCurrentRoot(issuerHex)`)  
- The nullifier status before the proof (`isNullifierUsed(nullifierHex) → false`)  
- A successful `proveIdentity(...)` transaction receipt  
- The nullifier status after the proof (`isNullifierUsed(nullifierHash) → true`)  

A final line:

✅ PXP-102 local Hardhat + Groth16 + SDK wiring OK.

This confirms the complete wiring between:

- Circom circuit + snarkjs Groth16 setup  
- IdentityPassVerifier + IdentityPass reference contracts  
- And the privacyx-sdk IdentityPass module on a local Hardhat node.

---

## 5) PXP-102 — Mainnet Identity Status API

**File:** `identity-pass-mainnet-status-api.example.mjs`

This script exposes a small HTTP API (Express) that lets integrators:

- Check the current Merkle root for a given issuer (PXP-102)
- Check whether a given nullifier has already been used on-chain (i.e. identity already proven)

It connects directly to the **IdentityPass** contract deployed on Ethereum mainnet.

### Environment variables

- `RPC_URL` — Mainnet JSON-RPC endpoint (Infura, Alchemy, etc.)
- `IDENTITY_PASS_ADDRESS` — IdentityPass contract address on mainnet

For the PrivacyX reference deployment, this is currently:

`IDENTITY_PASS_ADDRESS=0x2b8899B3ACDe63Fd5ABefa0D75d5982622665498`

### Run the API locally

cd ~/privacyx-sdk

export RPC_URL="https://mainnet.infura.io/v3/YOUR_KEY"  
export IDENTITY_PASS_ADDRESS="0x2b8899B3ACDe63Fd5ABefa0D75d5982622665498"

PORT=4000 node examples/identity-pass-mainnet-status-api.example.mjs

You should see:

✅ PXP-102 status API listening on http://localhost:4000  
• GET /  
• GET /health  
• GET /pxp-102/status/default  
• GET /pxp-102/status?issuer=0x...&nullifier=0x...

### Endpoints

**GET /**  
Basic metadata banner:

{
  "name": "PrivacyX Identity Pass Status API",
  "standard": "PXP-102",
  "network": "mainnet",
  "contractAddress": "0x2b88...",
  "endpoints": [
    "/health",
    "/pxp-102/status/default",
    "/pxp-102/status?issuer=0x...&nullifier=0x..."
  ]
}

**GET /health**  
Simple healthcheck for monitoring:

curl http://localhost:4000/health

Example response:

{
  "status": "ok",
  "network": "mainnet",
  "blockNumber": 23871799,
  "contractAddress": "0x2b88..."
}

**GET /pxp-102/status/default**  
Uses the demo issuer/nullifier from identity_public.example.json:

curl http://localhost:4000/pxp-102/status/default

Example response:

{
  "network": "mainnet",
  "contractAddress": "0x2b88...",
  "issuerHex": "0x0000...0002",
  "nullifierHex": "0x0000...0007",
  "currentRoot": "5",
  "expectedRoot": "5",
  "rootMatches": true,
  "nullifierUsed": false
}

**GET /pxp-102/status?issuer=0x...&nullifier=0x...**  
Generic endpoint for real issuers / nullifiers:

curl "http://localhost:4000/pxp-102/status?issuer=0xISSUER_BYTES32&nullifier=0xNULLIFIER_BYTES32"

Example response:

{
  "network": "mainnet",
  "contractAddress": "0x2b88...",
  "issuerHex": "0xISSUER...",
  "nullifierHex": "0xNULLIFIER...",
  "currentRoot": "123456789...",
  "nullifierUsed": false
}

This API is the base building block for:

- dApps that want to check if a PXP-102 identity has already been proven  
- KYC / access-control layers needing a simple "has this nullifier been seen?" endpoint  
- Dashboards or monitoring tools around PXP-102 issuers and identities

### Run with Docker

You can also run the status API as a standalone Docker container.

Build the image:

docker build -t privacyx/pxp102-status-api:local .

Run the container:

docker run --rm \
  -p 4000:4000 \
  -e RPC_URL="https://mainnet.infura.io/v3/YOUR_KEY" \
  -e IDENTITY_PASS_ADDRESS="0x2b8899B3ACDe63Fd5ABefa0D75d5982622665498" \
  -e PXP102_API_KEY="your-strong-api-key" \
  privacyx/pxp102-status-api:local

Then you can query:

curl http://localhost:4000/health  
curl -H "x-api-key: your-strong-api-key" \
  "http://localhost:4000/pxp-102/status/default"

This is the recommended way for partners and backends to integrate PXP-102 status checks in production.

